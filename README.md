# Avito Search Reranker

–†–µ—à–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è –¥–ª—è —Å—Ç–∞–∂–∏—Ä–æ–≤–∫–∏ –ê–≤–∏—Ç–æ: –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ **—Ä–µ—Ä–∞–Ω–∫–∏–Ω–≥–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π –≤ –ø–æ–∏—Å–∫–µ**.  
–¶–µ–ª—å ‚Äî –æ–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å, –∫–æ—Ç–æ—Ä–∞—è –≤–Ω—É—Ç—Ä–∏ –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ (`query_id`) —É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏—è (`item_id`) –ø–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏.

--- 

## üìå –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

-   –û–±—É—á–µ–Ω–∏–µ –ø—Ä–æ–≤–æ–¥–∏–ª–æ—Å—å –Ω–∞ –Ω–æ—É—Ç–±—É–∫–µ (16 –ì–ë RAM), –ø–æ—ç—Ç–æ–º—É:
    -   –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è —Å—ç–º–ø–ª–∏–Ω–≥ train-–Ω–∞–±–æ—Ä–∞, –æ–±—É—á–µ–Ω–∏–µ –ø—Ä–æ–≤–æ–¥–∏–ª–æ—Å—å –Ω–∞ 30_000 –∑–∞–ø—Ä–æ—Å–æ–≤;
    -   –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª–Ω—ã–º–∏ `.parquet` –ø—Ä–∏–º–µ–Ω—è–ª—Å—è duckdb/dask;
    -   —á–∞—Å—Ç—å –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ —É–ø—Ä–æ—â–µ–Ω–∞ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤.
-   –§–∏–Ω–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å ‚Äî LightGBM Ranker —Å objective=lambdarank.
-   –ö–∞—Å—Ç–æ–º–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞: `NDCG@10` —Å decay 0.97^rank (–∫–∞–∫ –≤ –≥—Ä–µ–π–¥–µ—Ä–µ).
-   –í–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ GroupKFold –ø–æ `query_id` (—á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —É—Ç–µ—á–µ–∫).
-   –ü—Ä–∏–∑–Ω–∞–∫–∏ –≤–∫–ª—é—á–∞—é—Ç:
    -   —Ü–µ–Ω–æ–≤—ã–µ (log, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è, —Ä–∞–Ω–≥–∏, z-score);
    -   CTR (–∫–ª–∏–ø–ø–∏–Ω–≥, –ª–æ–≥, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ –∑–∞–ø—Ä–æ—Å—É);
    -   —Ç–µ–∫—Å—Ç–æ–≤—ã–µ (TF-IDF, BM25, —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ –Ω–∞–∑–≤–∞–Ω–∏—è –∏ –∑–∞–ø—Ä–æ—Å–∞ —á–µ—Ä–µ–∑ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏);
    -   —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ (–¥–ª–∏–Ω—ã —Ç–µ–∫—Å—Ç–æ–≤, –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤, —á–∞—Å—Ç–æ—Ç—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π/–ª–æ–∫–∞—Ü–∏–π).
-   –§–æ–∫—É—Å –Ω–∞ **L2-—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–∏**: –∫–∞–Ω–¥–∏–¥–∞—Ç—ã —É–∂–µ –æ—Ç–æ–±—Ä–∞–Ω—ã –ø–æ –ª–µ–∫—Å–∏–∫–µ, –ø–æ—ç—Ç–æ–º—É —É–ø–æ—Ä —Å–¥–µ–ª–∞–Ω –Ω–∞ ¬´–¥–æ—Ä–æ–≥–∏–µ¬ª –ø—Ä–∏–∑–Ω–∞–∫–∏ ‚Äî —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –∏ –≤–Ω—É—Ç—Ä–∏-–∑–∞–ø—Ä–æ—Å–Ω—ã–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏.

## üöÄ –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

-   –î–æ–±–∞–≤–∏—Ç—å —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∏—á–∏ (—ç–º–±–µ–¥–¥–∏–Ω–≥–∏ query ‚Üî description).
-   –ü–æ–¥–±–æ—Ä –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —á–µ—Ä–µ–∑ Optuna.
-   –û–±—É—á–µ–Ω–∏–µ –Ω–∞ –ø–æ–ª–Ω–æ–º –¥–∞—Ç–∞—Å–µ—Ç–µ (–Ω–∞ –±–æ–ª–µ–µ –º–æ—â–Ω–æ–º –∂–µ–ª–µ–∑–µ).
-   –°—Ä–∞–≤–Ω–∏—Ç—å LightGBM –∏ CatBoost Ranker.

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```

‚îú‚îÄ‚îÄ data/                # –î–∞–Ω–Ω—ã–µ
‚îÇ   ‚îú‚îÄ‚îÄ raw/             # –°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ (.parquet –∏–∑ –∑–∞–¥–∞–Ω–∏—è)
‚îÇ   ‚îú‚îÄ‚îÄ transformed/     # –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ/–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îÇ   ‚îî‚îÄ‚îÄ solution.csv     # –§–∏–Ω–∞–ª—å–Ω—ã–π —Å–∞–±–º–∏—Ç
‚îÇ
‚îú‚îÄ‚îÄ models/              # –°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏
‚îÇ   ‚îî‚îÄ‚îÄ lgbm_ranker.txt  # –§–∏–Ω–∞–ª—å–Ω–∞—è LightGBM Ranker
‚îÇ
‚îú‚îÄ‚îÄ notebooks/           # –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–æ—É—Ç–±—É–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ eda.ipynb        # –†—Ä–∞–∑–≤–µ–¥–æ—á–Ω—ã–π –∞–Ω–∞–ª–∏–∑
‚îÇ   ‚îú‚îÄ‚îÄ features.ipynb   # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ train_lgbm.ipynb # –û–±—É—á–µ–Ω–∏–µ LightGBM Ranker + –≤–∞–ª–∏–¥–∞—Ü–∏—è
‚îÇ
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îî‚îÄ‚îÄ cluster.py       # –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ Dask-–∫–ª–∞—Å—Ç–µ—Ä–∞
‚îÇ
‚îú‚îÄ‚îÄ pyproject.toml       # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞
‚îî‚îÄ‚îÄ README.md            # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

```

---

## ‚öôÔ∏è –ö–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å

1. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è**

    ```bash
    uv sync
    ```

2. **–ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ Dask-–∫–ª–∞—Å—Ç–µ—Ä–∞**
   –ü–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –Ω–æ—É—Ç–±—É–∫–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–ª–∞—Å—Ç–µ—Ä:

    ```bash
    uv run scripts/cluster.py
    ```

    > –ö–ª–∞—Å—Ç–µ—Ä –Ω—É–∂–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–æ–ª—å—à–∏–º–∏ `.parquet` (train \~3.5GB).
    > –í–Ω—É—Ç—Ä–∏ –Ω–æ—É—Ç–±—É–∫–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–ª–∏–µ–Ω—Ç `Client()` –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.

3. **–ü–æ—Ä—è–¥–æ–∫ —Ä–∞–±–æ—Ç—ã**

    - `notebooks/eda.ipynb`
      –ü–µ—Ä–≤–∏—á–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö, –±–∞–ª–∞–Ω—Å —Ç–∞—Ä–≥–µ—Ç–∞, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è.
    - `notebooks/features.ipynb`
      –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–∞–∑–æ–≤—ã—Ö —Ñ–∏—á–µ–π (—Ü–µ–Ω–∞, CTR, –¥–ª–∏–Ω—ã —Ç–µ–∫—Å—Ç–æ–≤, match-–ø—Ä–∏–∑–Ω–∞–∫–∏ –∏ —Ç.–¥.).
      –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `data/transformed/`.
    - `notebooks/train_lgbm.ipynb`
      –û–±—É—á–µ–Ω–∏–µ LightGBM Ranker (objective=lambdarank),
      –≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ `GroupKFold(query_id)`, –º–µ—Ç—Ä–∏–∫–∞ `NDCG@10`.
      –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –º–æ–¥–µ–ª—å (`models/lgbm_ranker.txt`) –∏ —Å–∞–±–º–∏—Ç (`data/solution.csv`).
